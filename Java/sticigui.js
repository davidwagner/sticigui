function Stici_HistHiLite(e,t){function r(){function o(){var e=parseFloat(n.areaFromSlider.slider("value")),t=parseFloat(n.areaToSlider.slider("value")),r=n.chartDiv.width()/(n.binEnds.max()-n.binEnds.min()),i=(e-n.binEnds.min())*r,s=(t-n.binEnds.min())*r;n.overlayDiv.css("clip","rect(0px,"+s+"px,"+n.chartDiv.height()+"px,"+i+"px)");var o=histHiLitArea(e,t,n.binEnds,n.binCounts)*100,u="Selected area: "+o.fix(2)+"%";if(n.showingNormal){var a=n.mu,f=n.sd;o=Math.max(0,(normCdf((t-a)/f)-normCdf((e-a)/f))*100),u+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",u+="Normal approx: "+o.fix(2)+"%"}n.areaInfoDiv.html(u)}function f(){var e=jQuery("<div/>").addClass("popbox"),t=jQuery("<button/>").addClass("open").text("Click Here!"),n=jQuery("<div/>").addClass("collapse");n.html('<div class="box">  <div class="arrow"></div>  <div class="arrow-border"></div>  <div class="popbox-content">  </div>  <a href="#" class="close">close</a></div>'),e.append(t).append(n);var r=n.find(".popbox-content");return r.text("Content Here :)"),e.data("onPopBox",function(){e.find(".viewport").parent().width(r.width()+20)}),{parent:e,button:t,content:r}}var e=jQuery("<div/>").addClass("stici").addClass("stici_histogram");n.container.append(e);if(n.dataSource!==null){n.urlInput=jQuery('<input type="text" />'),n.dataSelect=jQuery("<select/>").change(n.reloadData),n.variableSelect=jQuery("<select/>").change(n.reloadChart);var t=jQuery("<div/>").addClass("top_controls");t.append("Data: ").append(n.dataSelect),jQuery.each(n.options.data,function(e,t){n.dataSelect.append(jQuery("<option/>").attr("value",t).text(t))}),t.append("Variable: ").append(n.variableSelect),e.append(t)}n.chartDiv=jQuery("<div/>").addClass("stici_chart").addClass("chart_box"),e.append(n.chartDiv),n.areaInfoDiv=jQuery("<div/>").addClass("area_info"),e.append(n.areaInfoDiv);var r=jQuery("<div/>").addClass("bottom_controls");e.append(r);var i=jQuery("<div/>"),s=jQuery("<div/>");r.append(i).append(s),n.binsInput=jQuery('<input type="text" />').val(n.options.bins),n.binsInput.change(function(){n.nBins=parseInt(n.binsInput.val(),10),n.reloadChart()}),n.options.changeNumBins||n.binsInput.attr("readonly",""),n.areaFromInput=jQuery('<input type="text" />').change(function(){n.areaFromSlider.slider("value",n.areaFromInput.val())});var u=function(){n.areaFromInput.val(n.areaFromSlider.slider("value")),o()};n.areaFromSlider=jQuery("<span/>").addClass("slider").slider({change:u,slide:u,step:.001}),i.append("Area from: ").append(n.areaFromInput).append(n.areaFromSlider),n.areaToInput=jQuery('<input type="text" />').change(function(){n.areaToSlider.slider("value",n.areaToInput.val())});var a=function(){n.areaToInput.val(n.areaToSlider.slider("value")),o()};n.areaToSlider=jQuery("<span/>").addClass("slider").slider({change:a,slide:a,step:.001}),i.append(" to: ").append(n.areaToInput).append(n.areaToSlider),i.append("Bins: ").append(n.binsInput);var l=null,c=f();c.button.text("List Data"),c.button.click(function(e){e.preventDefault();var t=n.dataFields,r=n.dataValues,i=t.length,s,o,u,a;a='<div class="table-container"><div class="table-header"><table class="data-fields"><thead><tr>';for(var f=0;f<t.length;f++)a+="<td>"+t[f]+"</td>";a+="</tr></thead></table></div>",a+='<div class="table-body"><table class="data-values"><tbody>';for(var l=0;l<r.length;l++){s=r[l],s.length>t.length&&(u=s.slice(t.length-1).join(" ").replace(/[\/]/g,""),s=s.slice(0,t.length-1),s.push(u)),a+='<tr data-index="'+l+'">';for(var h=0;h<s.length;h++)o=s[h],a+="<td>"+o+"</td>";a+="</tr>"}a+="</tbody></table></div></div>",c.content.html(a)}),n.options.listData&&s.append(c.parent);var h=f();h.button.text("Univariate Stats"),h.button.click(function(e){e.preventDefault();var t='<div class="univariate-stats-container">';$.each(n.dataFields,function(e){t+='<div class="univariate-stat-wrapper"><h3>'+n.dataFields[e]+"</h3>";var r=$.map(n.dataValues,function(t){return parseFloat(t[e])});t+='<ul class="stat-list"><li class="stat-item">Cases: '+r.length+"</li>"+'<li class="stat-item">Mean: '+mean(r).toFixed(2)+"</li>"+'<li class="stat-item">SD: '+sd(r).toFixed(2)+"</li>"+'<li class="stat-item">Min: '+r.min().toFixed(2)+"</li>"+'<li class="stat-item">LQ: '+percentile(r,25).toFixed(2)+"</li>"+'<li class="stat-item">Median: '+percentile(r,50).toFixed(2)+"</li>"+'<li class="stat-item">UQ: '+percentile(r,75).toFixed(2)+"</li>"+'<li class="stat-item">Max: '+r.max().toFixed(2)+"</li>"+"</ul>",t+="</div>"}),t+="</div>",h.content.html(t)}),n.options.showUnivariateStats&&s.append(h.parent),n.showNormalButton=jQuery("<button/>").addClass("open"),n.options.showNormal?n.showNormalButton.text("Hide Normal Curve"):n.showNormalButton.text("Show Normal Curve"),n.showNormalButton.click(function(e){e.preventDefault(),n.normalOverlayDiv.toggle(),n.showingNormal?n.showNormalButton.text(n.showNormalButton.text().replace("Hide","Show")):n.showNormalButton.text(n.showNormalButton.text().replace("Show","Hide")),n.showingNormal=!n.showingNormal,o()}),n.options.showNormalButton&&s.append(n.showNormalButton),jQuery(".popbox").popbox()}var n=this;if(!t instanceof Object){console.error("Stici_HistHiLite params should be an object");return}this.options={showNormalButton:!0,showNormal:!1,bins:10,changeNumBins:!0,showUnivariateStats:!0,hiLiteHi:null,hiLiteLo:null,data:null,listData:!0,counts:null,ends:null,n:null,p:null},jQuery.extend(this.options,t),this.container=jQuery("#"+e),this.dataFields=null,this.dataValues=null,this.dataSource=null,this.data=null,this.nBins=n.options.bins,this.binEnds=null,this.binCounts=null,this.sd=0,this.mu=0,this.urlInput=null,this.dataSelect=null,this.variableSelect=null,this.chartDiv=null,this.overlayDiv=null,this.normalOverlayDiv=null,this.areaFromInput=null,this.areaFromSlider=null,this.areaToInput=null,this.areaToSlider=null,this.binsInput=null,this.areaInfoDiv=null,this.showNormalButton=null,this.showingNormal=!1;if(n.options.n!==null||n.options.p!==null)n.options.showUnivariateStats=!1,n.options.listData=!1,n.options.changeNumBins=!1;else if(n.options.counts!==null||n.options.ends!==null)this.dataSource=null,t.showNormal||(n.options.showNormal=!1),t.showNormalButton||(n.options.showNormalButton=!1),n.options.showUnivariateStats=!1,n.options.listData=!1,n.options.changeNumBins=!1;else{if(!(n.options.data instanceof Array)){console.error("Unknown data source.");return}this.dataSource=this.options.data[0]}n.showingNormal=n.options.showNormal,this.reloadData=function(){var e=0;n.dataFields=[],n.dataValues=[];if(n.options.data!==null)n.dataSource=n.dataSelect.val(),jQuery.getJSON(n.dataSource,function(e){n.dataFields=e[0],n.dataValues=e.slice(1),n.variableSelect.children().remove(),jQuery.each(n.dataFields,function(e,t){if(t.indexOf("//")===0)return;n.variableSelect.append(jQuery("<option/>").attr("value",e).text(t))}),n.variableSelect.val(2),n.data=jQuery.map(n.dataValues,function(e){return parseFloat(e[n.variableSelect.val()])}),n.binEnds=histMakeBins(n.nBins,n.data),n.binCounts=histMakeCounts(n.binEnds,n.data),n.sd=sd(n.data),n.mu=mean(n.data),n.reloadChart()});else if(n.options.n===null||n.options.p===null){n.data=[n.options.ends.min(),n.options.ends.max()],n.options.sd===null?n.sd=sd(n.data):n.sd=n.options.sd,n.options.mu===null?n.mu=mean(n.data):n.mu=n.options.mu,n.binEnds=n.options.ends,n.binCounts=n.options.counts;var t=n.binCounts.reduce(function(e,t){return e+t});for(e=0;e<n.binCounts.length;e++)n.binCounts[e]/=t*(n.binEnds[e+1]-n.binEnds[e]);n.reloadChart()}else{var r=n.options.p,i=n.options.n;n.nBins=i+1,n.binCounts=[Math.pow(1-r,i)],n.binEnds=[-0.5];for(e=1;e<n.nBins;e++)r<1?n.binCounts.push(n.binCounts[e-1]*r*(i-e+1)/((1-r)*e)):n.binCounts.push(0),n.binEnds.push(e-.5);n.binEnds.push(i+.5),r==1&&(n.binCounts[n.nBins-1]=1),n.sd=Math.sqrt(i*r*(1-r)),n.mu=i*r,n.reloadChart()}},this.reloadChart=function(){function a(e){return d3.select(e.get(0)).append("svg").selectAll("div").data(n.binCounts).enter().append("rect").attr("y",function(e){return i-e/u}).attr("height",function(e){return e/u}).attr("x",function(e,t){return r*(n.binEnds[t]-n.binEnds.min())/s}).attr("width",function(e,t){return r*(n.binEnds[t+1]-n.binEnds[t])/s})}var e;n.chartDiv.children().remove();var t=jQuery("<div/>").addClass("chart_box");n.overlayDiv=t.clone().addClass("overlay"),n.normalOverlayDiv=jQuery("<div/>").addClass("chart_box"),n.chartDiv.append(t),n.chartDiv.append(n.overlayDiv),n.chartDiv.append(n.normalOverlayDiv);var r=n.overlayDiv.width(),i=n.overlayDiv.height(),s=n.binEnds.max()-n.binEnds.min(),o=function(e){var t=n.binEnds[0]+e*(n.binEnds[n.nBins]-n.binEnds[0])/(r-1),i=normPdf(n.mu,n.sd,t);return i},u=null;for(e=0;e<r;e++)(u===null||o(e)>u)&&!isNaN(o(e))&&(u=o(e));u=Math.max(n.binCounts.max(),u),u/=i-1,a(t),a(n.overlayDiv),n.overlayDiv.css("clip","rect(0px, 0px, "+i+"px, 0px)");var f=d3.select(t.get(0)).append("svg").attr("class","axis"),l=d3.scale.linear().domain([n.binEnds.min(),n.binEnds.max()]).range([0,r]),c=d3.svg.axis().scale(l).orient("bottom");f.append("g").call(c);var h=d3.svg.line().x(function(e){return e}).y(function(e){return i-o(e)/u});d3.select(n.normalOverlayDiv.get(0)).append("svg").append("path").data([d3.range(0,r)]).attr("d",h).style("fill","none").style("stroke","#000000"),n.areaFromSlider.slider("option","min",n.binEnds.min()),n.areaFromSlider.slider("option","max",n.binEnds.max()),n.options.hiLiteLo===null?(n.areaFromSlider.slider("option","value",n.binEnds.min()),n.areaFromInput.val(n.binEnds.min())):(n.areaFromSlider.slider("option","value",n.options.hiLiteLo),n.areaFromInput.val(n.options.hiLiteLo)),n.areaToSlider.slider("option","min",n.binEnds.min()),n.areaToSlider.slider("option","max",n.binEnds.max()),n.options.hiLiteHi===null?(n.areaToSlider.slider("option","value",n.binEnds.min()),n.areaToInput.val(n.binEnds.min())):(n.areaToSlider.slider("option","value",n.options.hiLiteHi),n.areaToInput.val(n.options.hiLiteHi)),n.showingNormal=n.options.showNormal,n.options.showNormal?n.showNormalButton.text("Hide Normal Curve"):(n.showNormalButton.text("Show Normal Curve"),n.normalOverlayDiv.hide())},r(),this.reloadData()}function Stici_Scatterplot(e,t){function r(){var e=$("<div/>").addClass("stici"),t=$("<div/>").addClass("top_controls");n.container.append(e),n.urlInput=$('<input type="text" />'),n.dataSelect=$('<select class="data_select"/>').change(n.reloadData),n.xVariableSelect=$('<select class="variable_select"/>').change(n.reloadChart),n.yVariableSelect=$('<select class="variable_select"/>').change(n.reloadChart),t.append("Data: ").append(n.dataSelect),$.each(n.options.data,function(e,t){n.dataSelect.append($("<option/>").attr("value",t).text(t))}),t.append(n.yVariableSelect),t.append(" vs "),t.append(n.xVariableSelect),e.append(t),n.chartDiv=$("<div/>").addClass("stici_chart").addClass("chart_box").attr("id","scatterplot"),e.append(n.chartDiv);var r=$("<div/>").addClass("bottom_controls").addClass("extended"),i=$("<span/>").attr("id","r-hat").text("r: 0.16"),s=$("<button/>").attr("id","sds").text("SDs"),o=$("<button/>").attr("id","sd-line").text("SD Line"),u=$("<button/>").attr("id","graph-of-ave").text("Graph of Ave"),a=$("<button/>").attr("id","reg-line").text("Regression Line"),f=$("<button/>").attr("id","res-plot").text("Plot Residuals"),l=$("<div/>").attr("class","popbox-controls"),c=$("<button/>").attr("id","use-points").text("Use Added Points"),h=$("<button/>").attr("id","clear-points").text("Clear Added Points"),p=$("<span/>").attr("id","cursor-pos").text("");e.append(r),r.append(i).append(s).append(o).append(u).append(a).append(f).append("<br/>").append(l).append(c).append(h).append(p)}function i(e){var t=$(e.target),r=t.attr("id");r!=="clear-points"&&r!=="list-data"&&r!=="univar-stats"&&(t.toggleClass("selected"),n.bottomControls[r]=n.bottomControls[r]===!0?!1:!0),n.toggleOption(r,t.hasClass("selected"))}function s(e){var t=e.type,r=$(e.target),i=r.closest("table"),s,o;i.hasClass("data-values")&&(s=r.closest("tr"),o=s.attr("data-index"),n.highlightDataPoint(o,t))}var n=this;if(!t instanceof Object){console.error("Stici_ScatterPlot params should be an object");return}this.options=t,this.container=$("#"+e),this.dataFields=null,this.dataValues=null,this.dataSource=null,this.urlInput=null,this.dataSelect=null,this.xVariableSelect=null,this.yVariableSelect=null,this.currentData=null,this.xScale=null,this.yScale=null,this.chartWidth=null,this.chartHeight=null,this.chartMargins=null,this.chartDiv=null,this.graphOfAvePoints=null,this.chartMargins={top:"10",right:"10",bottom:"25",left:"50"},this.bottomControls={sds:!1,"sd-line":!1,"avg-graph":!1,"reg-line":!1,"res-plot":!1,"use-points":!1,"plot-mean":!0,"r-hat":!0},!t.data instanceof Array?(this.dataSource=null,this.options.data=[]):(this.dataSource=this.options.data[0],this.graphOfAvePoints=this.options.graphOfAvePoints||9,this.chartMargins={top:this.options.chartMargins[0],right:this.options.chartMargins[1],bottom:this.options.chartMargins[2],left:this.options.chartMargins[3]},this.chartWidth=this.container.width()-20,this.chartHeight=this.container.height()-100),this.reloadData=function(){var e=$(".bottom_controls"),t=$(".popbox-controls");n.options.data=[],n.dataFields=[],n.dataValues=[],n.dataSource=$("select.data_select").val(),jQuery.getJSON(n.dataSource,function(e){n.dataFields=e[0],n.dataValues=e.slice(1),n.xVariableSelect.empty(),n.yVariableSelect.empty(),$.each(n.dataFields,function(e,t){if(t.indexOf("//")>-1)return!0;n.xVariableSelect.append($("<option/>").attr("value",e).text(t)),n.yVariableSelect.append($("<option/>").attr("value",e).text(t))}),n.xVariableSelect.val(3),n.yVariableSelect.val(2),$(".popbox-controls").empty(),n.createPopbox("list-data"),n.createPopbox("univar-stats"),$(".popbox").popbox({toggler:["list-data","univar-stats"]}),$(".popbox-content table").css("width",n.dataFields.length*100+"px"),n.reloadChart()})},this.prepareData=function(){n.currentData=$.map(n.dataValues,function(e,t){return{x:parseFloat(e[n.xVariableSelect.val()]),y:parseFloat(e[n.yVariableSelect.val()]),index:t,added:!1,selected:$('.popbox.list-data tr[data-index="'+t+'"]').hasClass("selected")}})},this.setScale=function(e){var t=n.chartWidth,r=n.chartMargins,i=d3.scale.linear().domain([d3.min(e,function(e){return e.x}),d3.max(e,function(e){return e.x})]).range([0,t-r.left-r.right]).nice(),s=d3.min(e,function(e){return e.y}),o=d3.max(e,function(e){return e.y}),u;o<.001&&s>-0.001&&(o=1,s=-1),u=d3.scale.linear().domain([s,o]).range([n.chartHeight-n.chartMargins.top-n.chartMargins.bottom,0]).nice(),n.xScale=i,n.yScale=u},this.initCanvas=function(){n.chartDiv.empty();var e=n.chartWidth,t=n.chartHeight,r=d3.select(n.chartDiv.get(0)).append("svg").attr("width",n.chartWidth).attr("height",n.chartHeight)},this.drawDataPlot=function(){var e=n.currentData;n.initCanvas(),n.setScale(e),n.plotAxes("data"),n.plotPoints(e,"data"),n.drawMouseRect(),n.updateRHat()},this.plotAxes=function(e){var t=n.xScale,r=n.yScale,i=n.chartMargins,s=n.chartWidth,o=n.chartHeight,u=d3.svg.axis().scale(t).orient("bottom"),a=d3.svg.axis().scale(r).orient("left"),f=d3.select("svg");e==="data"?f.append("g").attr("class","x axis").attr("transform","translate("+i.left+", "+(o-i.bottom)+")").call(u):f.append("g").attr("class","x axis").attr("transform","translate("+i.left+", "+(r(0)+1*i.top)+")").call(u),f.append("g").attr("class","y axis").attr("transform","translate("+i.left+", "+i.top+")").call(a),f.select("g.x.axis").append("line").attr("class","line x-axis").attr("x1",0).attr("x2",s-i.left).attr("y1",0).attr("y2",0),f.select("g.y.axis").append("line").attr("class","line y-axis").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",o-i.bottom-i.top)},this.reloadChart=function(){n.prepareData(),n.bottomControls["res-plot"]===!0?n.toggleResPlot(!0):(n.drawDataPlot(),n.plotSelectedOptions(["res-plot"]))},this.updateRHat=function(){var e=n.filterData(),t=$.map(e,function(e){return e.x}),r=$.map(e,function(e){return e.y}),i=corr(t,r).toFixed(2);$("#r-hat").text("r: "+i)},this.plotSelectedOptions=function(e){var t;e=e||[];for(var r in n.bottomControls){if(e.indexOf(r)>-1)continue;t=n.bottomControls[r],n.toggleOption(r,t)}},this.toggleOption=function(e,t){switch(e){case"sds":n.toggleSds(t);break;case"sd-line":n.toggleSdLine(t);break;case"graph-of-ave":n.toggleGraphOfAve(t);break;case"reg-line":n.toggleRegLine(t);break;case"res-plot":n.toggleResPlot(t);break;case"use-points":n.toggleUsePoints();break;case"clear-points":n.toggleClearPoints();break;case"plot-mean":n.plotMean();break;case"r-hat":n.updateRHat();break;default:}},this.createPopbox=function(e){var t,r,i,s;e==="list-data"?(r="List Data",t=n.createListDataHtml(),i="list-data"):e==="univar-stats"&&(r="Univariate Stats",t=n.createUnivarStatsHtml(),i="univar-stats"),s='<div class="popbox '+e+'">'+'<button class="open" id="'+i+'">'+r+"</button>"+'<div class="collapse">'+'<div class="box">'+'<div class="arrow"></div>'+'<div class="arrow-border"></div>'+'<div class="popbox-content">'+t+"</div>"+"</div>"+"</div>"+"</div>",$(".bottom_controls .popbox-controls").append(s)},this.createUnivarStatsHtml=function(){var e='<div class="univariate-stats-container">';return $.each(n.dataFields,function(t){e+='<div class="univariate-stat-wrapper"><h3>'+n.dataFields[t]+"</h3>";var r=$.map(n.dataValues,function(e){return parseFloat(e[t])});e+='<ul class="stat-list"><li class="stat-item">Cases: '+r.length+"</li>"+'<li class="stat-item">Mean: '+mean(r).toFixed(2)+"</li>"+'<li class="stat-item">SD: '+sd(r).toFixed(2)+"</li>"+'<li class="stat-item">Min: '+r.min().toFixed(2)+"</li>"+'<li class="stat-item">LQ: '+percentile(r,25).toFixed(2)+"</li>"+'<li class="stat-item">Median: '+percentile(r,50).toFixed(2)+"</li>"+'<li class="stat-item">UQ: '+percentile(r,75).toFixed(2)+"</li>"+'<li class="stat-item">Max: '+r.max().toFixed(2)+"</li>"+"</ul>",e+="</div>"}),e+="</div>",e},this.createListDataHtml=function(){var e=n.dataFields,t=n.dataValues,r=e.length,i,s,o,u;u='<div class="table-container"><div class="table-header"><table class="data-fields"><thead><tr>';for(var a=0;a<e.length;a++)u+="<td>"+e[a]+"</td>";u+="</tr></thead></table></div>",u+='<div class="table-body"><table class="data-values"><tbody>';for(var f=0;f<t.length;f++){i=t[f],i.length>e.length&&(o=i.slice(e.length-1).join(" ").replace(/[\/]/g,""),i=i.slice(0,e.length-1),i.push(o)),u+='<tr data-index="'+f+'">';for(var l=0;l<i.length;l++)s=i[l],u+="<td>"+s+"</td>";u+="</tr>"}return u+="</tbody></table></div></div>",u},this.toggleClearPoints=function(){n.currentData=$.grep(n.currentData,function(e,t){return e.added===!1}),d3.selectAll('.data-point[data-added="true"]').remove(),n.plotSelectedOptions(["res-plot","use-points"])},this.toggleUsePoints=function(){n.plotSelectedOptions(["res-plot","use-points"]),n.bottomControls["res-plot"]&&n.toggleResPlot(!0)},this.toggleResPlot=function(e){var t=n.filterData(),r=$.map(t,function(e){return e.x}),i=$.map(t,function(e){return e.y}),s=mean(r),o=mean(i),u=sd(r),a=sd(i),f=corr(r,i),l=f*a/u,c,h,p,d,v=n.currentData.length;if(e){n.initCanvas(),n.residualData=[];for(var m=0;m<v;m++)h=n.currentData[m],c=o-l*(s-h.x),p=h.y-c,n.residualData.push({x:h.x,y:p,added:h.added,index:h.index});n.setScale(n.residualData),n.plotAxes("residual"),n.plotPoints(n.residualData,"residual"),n.drawMouseRect(),n.plotSelectedOptions(["res-plot","use-points"])}else n.drawDataPlot(),n.plotSelectedOptions(["res-plot"])},this.plotPoints=function(e,t){var r=n.chartMargins,i=n.xScale,s=n.yScale,o=t==="data"?"plot-data":"plot-residual",u=d3.select("svg").append("g").attr("class",o+" plot").attr("transform","translate("+r.left+","+r.top+")"),a;u.selectAll("circle").data(e).enter().append("circle").attr("class",function(e){var t="data-point",n=e.selected?"selected":"",r=e.added?"added":"";return t+" "+n+" "+r}).attr("cx",function(e){return i(e.x)}).attr("cy",function(e){return s(e.y)}).attr("stroke","#333").attr("stroke-width","1").attr("data-index",function(e){return e.index}).attr("data-added",function(e){return e.added}).attr("data-x",function(e){return e.x}).attr("data-y",function(e){return e.y}).attr("r",function(e){return e.selected?3.5:2}).attr("fill",function(e){return"rgba(0, 0, 255, 1)"}),d3.selectAll(".data-point").sort(function(e){return e&&e.selected===!0?1:-1})},this.drawMouseRect=function(){var e=n.chartMargins,t=n.chartWidth,r=n.chartHeight,i=n.xScale,s=n.yScale,o=d3.select(".plot");o.append("rect").attr("class","mouse-event-handler").attr("width",t-e.left-e.right).attr("height",r-e.top-e.bottom).attr("fill","rgba(0, 0, 0, 0)").on("mousemove",function(){var e=d3.mouse(this),t=e[0],n=e[1],r=i.invert(t).toFixed(2),o=s.invert(n).toFixed(2);$("#cursor-pos").text(" x = "+r+"  y = "+o)}),d3.select(".plot-data.plot .mouse-event-handler").on("click",function(){var e=d3.mouse(this),t=e[0],r=e[1],o=i.invert(t).toFixed(2),u=s.invert(r).toFixed(2),a={x:parseFloat(o),y:parseFloat(u),added:!0,index:n.currentData.length};n.currentData.push(a),n.plotPoint(a),!n.bottomControls["res-plot"]&&n.bottomControls["use-points"]&&n.plotSelectedOptions(["res-plot","use-points"])})},this.plotPoint=function(e){var t=n.yScale,r=n.xScale;pointPlot=d3.select(".plot-data.plot"),pointPlot.insert("circle",".data-point").attr("class","data-point added").attr("cx",r(e.x)).attr("cy",t(e.y)).attr("stroke","#333").attr("stroke-width","1").attr("data-index",e.index).attr("data-added",e.added).attr("data-x",e.x).attr("data-y",e.y).attr("r",2)},this.toggleRegLine=function(e){var t=n.filterData(),r,i,s,o,u,a,f,l,c,h,p,d,v,m;$("svg g.reg-line").remove(),e&&(r=$.map(t,function(e){return e.x}),i=$.map(t,function(e){return e.y}),u=d3.min(r),a=d3.max(r),s=mean(r),o=mean(i),f=sd(r),l=sd(i),h=corr(r,i),c=h*l/f,d={x:s,y:o},v={x:u,y:d.y-c*(d.x-u)},m={x:a,y:d.y-c*(d.x-a)},p=d3.select(".plot-data").append("g").attr("class","reg-line"),p.append("line").attr("x1",n.xScale(v.x)).attr("x2",n.xScale(m.x)).attr("y1",n.yScale(v.y)).attr("y2",n.yScale(m.y)))},this.toggleGraphOfAve=function(e){var t=n.bottomControls["res-plot"]===!0?"plot-residual":"plot-data",r=n.filterData(),i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;$("svg g.graph-of-ave").remove();if(e){i=$.map(r,function(e){return e.x}),s=$.map(r,function(e){return e.y}),o=d3.max(i),u=d3.min(i),w=(o-u)/n.graphOfAvePoints,a=mean(i),f=mean(s),l=sd(i),c=sd(s),h=corr(i,s),p=h*c/l,x=d3.select("."+t).append("g").attr("class","graph-of-ave");for(var T=0;T<n.graphOfAvePoints;T++){E=0,y=0,m=u+T*w,g=u+(T+1)*w;for(var N=0;N<r.length;N++)T===n.graphOfAvePoints-1?r[N].x>=m&&r[N].x<=g&&(y+=1,E+=r[N].y):r[N].x>=m&&r[N].x<g&&(y+=1,E+=r[N].y);y>0&&(S=E/y,b={x:(m+g)/2,y:S},t==="plot-residual"&&(d=f-p*(a-b.x),v=S-d,b={x:(m+g)/2,y:S-d}),x.append("rect").attr("x",n.xScale(b.x)-2.5).attr("y",n.yScale(b.y)-2.5).attr("height",5).attr("width",5))}}},this.toggleSdLine=function(e){var t=n.filterData(),r,i,s,o,u,a,f,l,c,h,p,d,v,m;$("svg g.sd-line").remove(),e&&(r=$.map(t,function(e){return e.x}),i=$.map(t,function(e){return e.y}),s=mean(r),o=mean(i),f=sd(r),l=sd(i),c=corr(r,i),u=d3.max(r),a=d3.min(r),yMin=d3.min(i),yMax=d3.max(i),h=(c>=0?1:-1)*l/f,p={x:s,y:o},d={x:a,y:p.y-h*(p.x-a)},v={x:u,y:p.y-h*(p.x-u)},d.y<yMin&&(d.x=p.x-(p.y-yMin)/h,d.y=yMin),v.y<yMin&&(v.x=(yMin-p.y)/h+s,v.y=yMin),m=d3.select(".plot-data").append("g").attr("class","sd-line"),m.append("line").attr("x1",n.xScale(d.x)).attr("x2",n.xScale(v.x)).attr("y1",n.yScale(d.y)).attr("y2",n.yScale(v.y)))},this.filterData=function(){var e=n.bottomControls["use-points"],t=n.currentData,r=t.length,i;return e?t:(i=$.grep(t,function(e,t){return e.added===!1}),i)},this.highlightDataPoint=function(e,t){var r=d3.select('.data-point[data-index="'+e+'"]'),i=r.classed("selected"),s;t==="mouseover"?(r.node().parentNode.appendChild(r.node()),r.classed("active",!0).transition().duration(200).attr("r",5)):t==="mouseout"?r.classed("active",!1).transition().duration(200).attr("r",function(){return i?3.5:2}):t==="click"&&(s=!i,r.classed("selected",s),n.currentData[e].selected=s,$('.popbox.list-data tr[data-index="'+e+'"]').toggleClass("selected"))},this.plotMean=function(){var e=n.filterData(),t=$.map(e,function(e){return e.x}),r=$.map(e,function(e){return e.y}),i=mean(t),s=n.bottomControls["res-plot"]===!0?0:mean(r),o=n.xScale,u=n.yScale,a=5;d3.select(".mean-point").remove(),d3.select("svg .plot").append("rect").attr("x",o(i)-a/2).attr("y",u(s)-a/2).attr("class","mean-point").attr("width",a).attr("height",a).attr("fill","rgba(255, 0, 0, 1)").attr("stroke","#000")},this.toggleSds=function(e){var t=n.filterData(),r,i,s,o,u,a,f,l,c;$("svg g.sds").remove(),e&&(u=$.map(t,function(e){return e.x}),a=$.map(t,function(e){return e.y}),r=mean(u),i=mean(a),s=sd(u),o=sd(a),f=[r-s,r+s],l=[i-o,i+o],c=d3.select(".plot-data").append("g").attr("class","sds"),c.append("line").attr("x1",n.xScale(f[0])).attr("x2",n.xScale(f[0])).attr("y1",0).attr("y2",n.chartHeight-n.chartMargins.bottom-n.chartMargins.top),c.append("line").attr("x1",n.xScale(f[1])).attr("x2",n.xScale(f[1])).attr("y1",0).attr("y2",n.chartHeight-n.chartMargins.bottom-n.chartMargins.top),c.append("line").attr("x1",0).attr("x2",n.chartWidth-n.chartMargins.left-n.chartMargins.right).attr("y1",n.yScale(l[0])).attr("y2",n.yScale(l[0])),c.append("line").attr("x1",0).attr("x2",n.chartWidth-n.chartMargins.left-n.chartMargins.right).attr("y1",n.yScale(l[1])).attr("y2",n.yScale(l[1])))},$().ready(function(){$("button").live("click",function(e){i(e)}),$(".popbox").live("mouseover mouseout click",function(e){s(e)})}),r(),this.reloadData()}function mean(e){return vSum(e)/e.length}function vMult(e,t){var n=new Array(t.length);for(var r=0;r<t.length;r++)n[r]=e*t[r];return n}function vScalarSum(e,t){var n=new Array(e.length);for(var r=0;r<e.length;r++)n[r]=e[r]+t;return n}function vVectorSum(e,t){if(e.length!=t.length)return alert("Error #1 in irGrade.vVectorSum: vector lengths are not equal"),Math.NaN;var n=new Array(length(e));for(var r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}function vPointwiseMult(e,t){var n=Math.NaN;if(e.length!=t.length)alert("Error #1 in irGrade.vPointwiseMult: vector lengths do not match!");else{n=new Array(e.length);for(var r=0;r<e.length;r++)n[r]=e[r]*t[r]}return n}function vFloor(e){var t=new Array(e.length);for(var n=0;n<e.length;n++)t[n]=Math.floor(e[n]);return t}function vCeil(e){var t=new Array(e.length);for(var n=0;n<e.length;n++)t[n]=Math.ceil(e[n]);return t}function vRoundToInts(e){var t=new Array(e.length),n;for(var r=0;r<e.length;r++)t[r]=Math.floor(e[r]),e[r]-t[r]>=.5&&t[r]++;return t}function vSum(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n];return t}function vProd(e){var t=1;for(var n=0;n<e.length;n++)t*=e[n];return t}function vCum(e){var t=e;for(var n=1;n<e.length;n++)t[n]+=t[n-1];return t}function vDiff(e){var t=new Array(e.length);for(var n=e.length-1;n>0;n--)t[n]=e[n]-e[n-1];return t[0]=e[0],t}function vInterval(e){var t=[];t[0]=e[0];for(var n=1;n<e.length;n++)t[n]=e[n]-e[n-1];return t}function vZero(e){var t=new Array(e);for(var n=0;n<e;n++)t[n]=0;return t}function vOne(e){var t=new Array(e);for(var n=0;n<e;n++)t[n]=1;return t}function twoNorm(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t)}function convolve(e,t){var n=new Array(e.length+t.length-1),r,i;for(var s=0;s<e.length+t.length-1;s++){n[s]=0,i=Math.min(s+1,e.length),r=Math.max(0,s-t.length+1);for(var o=r;o<i;o++)n[s]+=e[o]*t[t.length-s-1+o]}return n}function nFoldConvolve(e,t){var n=e;for(var r=0;r<t;r++)n=convolve(n,e);return n}function numberLessThan(e,t){var n=parseFloat(e)-parseFloat(t);return n<0?-1:n===0?0:1}function numberGreaterThan(e,t){var n=parseFloat(e)-parseFloat(t);return n<0?1:n===0?0:-1}function sd(e){ave=mean(e),ssq=0;for(var t=0;t<e.length;t++)ssq+=(e[t]-ave)*(e[t]-ave);return ssq=Math.sqrt(ssq/e.length),ssq}function sampleSd(e){ave=mean(e),ssq=0;for(var t=0;t<e.length;t++)ssq+=(e[t]-ave)*(e[t]-ave);return ssq=Math.sqrt(ssq/(e.length-1)),ssq}function corr(e,t){if(e.length!=t.length)return alert("Error #1 in irGrade.corr(): lists have different lengths!"),Math.NaN;var n=mean(e),r=mean(t),i=sd(e),s=sd(t),o=0;for(var u=0;u<e.length;u++)o+=(e[u]-n)*(t[u]-r);return o/=i*s*e.length,o}function percentile(e,t){var n=e.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[i].valueOf();r.sort(numberLessThan);var s=Math.max(Math.ceil(t*n/100),1);return r[s-1]}function histMakeCounts(e,t){var n=e.length-1,r=new Array(n),i=0;for(i=0;i<n;i++)r[i]=0;for(i=0;i<t.length;i++){for(var s=0;s<n-1;s++)t[i]>=e[s]&&t[i]<e[s+1]&&(r[s]+=1);t[i]>=e[n-1]&&(r[n-1]+=1)}for(i=0;i<n;i++)r[i]/=t.length*(e[i+1]-e[i]);return r}function histMakeBins(e,t){binEnd=new Array(e+1),dMnMx=vMinMax(t);for(var n=0;n<e+1;n++)binEnd[n]=dMnMx[0]+n*(dMnMx[1]-dMnMx[0])/e;return binEnd}function histEstimatedPercentile(e,t,n){var r=e/100,i;if(r>1)i=Math.NaN;else if(r==1)i=t[nBins];else{var s=0,o=0;while(s<r)o++,s=histHiLitArea(t[0],t[o],t,n);o--,s=r-histHiLitArea(t[0],t[o],t,n);var u=histHiLitArea(t[o],t[o+1],t,n);i=t[o]+s/u*(t[o+1]-t[o])}return i}function histHiLitArea(e,t,n,r){var i=n.length-1,s=0;if(e<t)for(var o=0;o<i;o++)n[o]>t||n[o+1]<=e||(n[o]>=e&&n[o+1]<=t?s+=r[o]*(n[o+1]-n[o]):n[o]>=e&&n[o+1]>t?s+=r[o]*(t-n[o]):n[o]<=e&&n[o+1]<=t?s+=r[o]*(n[o+1]-e):n[o]<e&&n[o+1]>t&&(s+=r[o]*(t-e)));return s}function listOfRandSigns(e){var t=new Array(e);for(var n=0;n<e;n++){var r=rand.next();r<.5?t[n]=-1:t[n]=1}return t}function listOfRandUniforms(e,t,n){if(typeof t=="undefined"||t===null)t=0;if(typeof n=="undefined"||n===null)n=1;var r=new Array(e);for(var i=0;i<e;i++)r[i]=t+(n-t)*rand.next();return r}function listOfRandInts(e,t,n){var r=new Array(e);for(var i=0;i<e;i++)r[i]=Math.floor((n+1-t)*rand.next())+t;return r}function listOfDistinctRandInts(e,t,n){var r=new Array(e),i,s=0,o;while(s<e){i=Math.floor((n+1-t)*rand.next())+t,o=!0;for(var u=0;u<s;u++)i==r[u]&&(o=!1);o&&(r[s]=i,s++)}return r}function randomSample(e,t,n){var r=[],i=[];n!==null&&n?i=listOfRandInts(t,0,e.length-1):i=listOfDistinctRandInts(t,0,e.length-1);for(var s=0;s<t;s++)r[s]=e[i[s]];return r}function randomPartition(e,t){var n=listOfDistinctRandInts(t-1,1,e.length-1).sort(numberLessThan);n[n.length]=e.length;var r=new Array(t),i=0;for(i=0;i<r.length;i++)r[i]=[];for(i=0;i<n[0];i++)r[0][i]=e[i];for(var s=1;s<t;s++)for(i=0;i<n[s]-n[s-1];i++)r[s][i]=e[n[s-1]+i];return r}function constrainedRandomPartition(e,t,n){if(t*n<e.length)return alert("Error in irGrade.constrainedRandomPartition: mx too small!"),!1;var r=listOfDistinctRandInts(t-1,1,e.length-1).sort(numberLessThan);r[r.length]=e.length,vm=vMinMax(vDiff(r))[1];while(vm>n)r=listOfDistinctRandInts(t-1,1,e.length-1).sort(numberLessThan),r[r.length]=e.length,vm=vMinMax(vDiff(r))[1];var i=new Array(t),s=0;for(s=0;s<i.length;s++)i[s]=[];for(s=0;s<r[0];s++)i[0][s]=e[s];for(var o=1;o<t;o++)for(s=0;s<r[o]-r[o-1];s++)i[o][s]=e[r[o-1]+s];return i}function multinomialSample(e,t){e=vMult(1/vSum(e),e);var n=vCum(e),r=vZero(e.length),i,s;for(var o=0;o<t;o++){i=rand.next(),s=0;while(i>n[s]&&s<t)s++;r[s]++}return r}function normPoints(e,t,n,r){var i=!0;if(typeof r=="undefined"||r===null)i=!1;var s=new Array(e),o=0;if(i)for(o=0;o<e;o++)s[o]=roundToDig(t+n*rNorm(),r);else for(o=0;o<e;o++)s[o]=t+n*rNorm();return s}function cNormPoints(e,t){var n=new Array(e),r=new Array(e),i=0;for(i=0;i<e;i++)n[i]=rNorm(),r[i]=rNorm();var s=corr(n,r),o=sgn(s)*sgn(t),u=mean(n),a=mean(r),f=sd(n),l=sd(r),c=new Array(e),h=new Array(e);for(i=0;i<e;i++)n[i]=(n[i]-u)/f,c[i]=o*s*n[i]*l+a,h[i]=o*r[i]-c[i];var p=rms(h);for(i=0;i<e;i++)r[i]=Math.sqrt(1-t*t)*h[i]/p+t*n[i];var d=vMinMax(r),v=vMinMax(n),m=9.5/(v[1]-v[0]),g=9.5/(d[1]-d[0]);for(i=0;i<e;i++)n[i]=(n[i]-v[0])*m+1,r[i]=(r[i]-d[0])*g+1;var y=new Array(n,r);return y}function listOfRandReals(e,t,n){var r=new Array(e);for(var i=0;i<e;i++)r[i]=(n-t)*rand.next()+t;return r}function rNorm(){var e=normInv(rand.next());return e}function normCdf(e){return.5*erfc(-e*.7071067811865475)}function erfc(e){var t=.46875,n=[3.1611237438705655,113.86415415105016,377.485237685302,3209.3775891384694,.18577770618460315],r=[23.601290952344122,244.02463793444417,1282.6165260773723,2844.236833439171],i=[.5641884969886701,8.883149794388377,66.11919063714163,298.6351381974001,881.952221241769,1712.0476126340707,2051.0783778260716,1230.3393547979972,2.1531153547440383e-8],s=[15.744926110709835,117.6939508913125,537.1811018620099,1621.3895745666903,3290.7992357334597,4362.619090143247,3439.3676741437216,1230.3393548037495],o=[.30532663496123236,.36034489994980445,.12578172611122926,.016083785148742275,.0006587491615298378,.016315387137302097],u=[2.568520192289822,1.8729528499234604,.5279051029514285,.06051834131244132,.0023352049762686918],a,f,l,c,h,p,d=0;if(Math.abs(e)<=t){a=Math.abs(e),f=a*a,l=n[4]*f,c=f;for(d=0;d<3;d++)l=(l+n[d])*f,c=(c+r[d])*f;h=1-e*(l+n[3])/(c+r[3])}else if(Math.abs(e)<=4){a=Math.abs(e),l=i[8]*a,c=a;for(d=0;d<7;d++)l=(l+i[d])*a,c=(c+s[d])*a;h=(l+i[7])/(c+s[7]),a>0?f=Math.floor(a*16)/16:f=Math.ceil(a*16)/16,p=(a-f)*(a+f),h=Math.exp(-f*f)*Math.exp(-p)*h}else{a=Math.abs(e),f=1/(a*a),l=o[5]*f,c=f;for(d=0;d<4;d++)l=(l+o[d])*f,c=(c+u[d])*f;h=f*(l+o[4])/(c+u[4]),h=(1/Math.sqrt(Math.PI)-h)/a,a>0?f=Math.floor(a*16)/16:f=Math.ceil(a*16)/16,p=(a-f)*(a+f),h=Math.exp(-f*f)*Math.exp(-p)*h}return e<-t&&(h=2-h),h}function normInv(e){return e===0?Math.NEGATIVE_INFINITY:e>=1?Math.POSITIVE_INFINITY:Math.sqrt(2)*erfInv(2*e-1)}function erfInv(e){var t=[.886226899,-1.645349621,.914624893,-0.140543331],n=[-2.118377725,1.442710462,-0.329097515,.012229801],r=[-1.970840454,-1.624906493,3.429567803,1.641345311],i=[3.5438892,1.6370678],s=.7,o=0,u=0;return Math.abs(e)<=s?(u=e*e,o=e*(((t[3]*u+t[2])*u+t[1])*u+t[0])/((((n[3]*u+n[2])*u+n[1])*u+n[0])*u+1)):e>s&&e<1?(u=Math.sqrt(-Math.log((1-e)/2)),o=(((r[3]*u+r[2])*u+r[1])*u+r[0])/((i[1]*u+i[0])*u+1)):e<-s&&e>-1&&(u=Math.sqrt(-Math.log((1+e)/2)),o=-(((r[3]*u+r[2])*u+r[1])*u+r[0])/((i[1]*u+i[0])*u+1)),o-=(1-erfc(o)-e)/(2/Math.sqrt(Math.PI)*Math.exp(-o*o)),o-=(1-erfc(o)-e)/(2/Math.sqrt(Math.PI)*Math.exp(-o*o)),o}function betaCdf(e,t,n){return t<=0||n<=0?Math.NaN:e>=1?1:e>0?Math.min(incBeta(e,t,n),1):0}function betaPdf(e,t,n){return t<=0||n<=0||e<0||e>1?Math.NaN:e===0&&t<1||e==2&&n<1?Math.POSITIVE_INFINITY:t<=0||n<=0||e<=0||e>=1?0:Math.exp((t-1)*Math.log(e)+(n-1)*Math.log(1-e)-lnBeta(t,n))}function lnBeta(e,t){return lnGamma(e)+lnGamma(t)-lnGamma(e+t)}function betaInv(e,t,n){if(e<0||e>1||t<=0||n<=0)return Math.NaN;if(e===0)return Math.NEGATIVE_INFINITY;if(e==1)return Math.POSITIVE_INFINITY;var r=100,i=0,s=Math.sqrt(eps),o=1,u,a;t===0?a=Math.sqrt(eps):n===0?a=1-Math.sqrt(eps):a=t/(t+n);while(Math.abs(o)>s*Math.abs(a)&&Math.abs(o)>s&&i<r){i++,o=(betaCdf(a,t,n)-e)/betaPdf(a,t,n),u=a-o;while(u<0||u>1)o/=2,u=a-o;a=u}return a}function lnGamma(e){var t=-0.5772156649015329,n=[4.945235359296727,201.8112620856775,2290.8383738313464,11319.672059033808,28557.246356716354,38484.962284437934,26377.487876241954,7225.813979700288],r=[67.48212550303778,1113.3323938571993,7738.757056935398,27639.870744033407,54993.102062261576,61611.22180066002,36351.2759150194,8785.536302431014],i=.42278433509846713,s=[4.974607845568932,542.4138599891071,15506.93864978365,184793.29044456323,1088204.7694688288,3338152.96798703,5106661.678927353,3074109.0548505397],o=[183.03283993705926,7765.049321445006,133190.38279660742,1136705.8213219696,5267964.117437947,13467014.543111017,17827365.303532742,9533095.591844354],u=1.791759469228055,a=[14745.0216605994,2426813.3694867045,121475557.40450932,2663432449.630977,29403789566.34554,170266573776.5399,492612579337.7431,560625185622.3951],f=[2690.5301758708993,639388.5654300093,41355999.30241388,1120872109.616148,14886137286.788137,101680358627.24382,341747634550.73773,446315818741.9713],l=[-0.001910444077728,.00084171387781295,-0.0005952379913043012,.0007936507935003503,-0.0027777777777776816,.08333333333333333,.0057083835261],c=Math.NaN,h=1e-12,p=1,d=0,v,m,g,y=0;if(e<0)return c;if(e<=h)return-Math.log(e);if(e<=.5){for(y=0;y<8;y++)d=d*e+n[y],p=p*e+r[y];c=-Math.log(e)+e*(t+e*(d/p))}else if(e<=.6796875){v=e-1;for(y=0;y<8;y++)d=d*v+s[y],p=p*v+o[y];c=-Math.log(e)+v*(i+v*(d/p))}else if(e<=1.5){v=e-1;for(y=0;y<8;y++)d=d*v+n[y],p=p*v+r[y];c=v*(t+v*(d/p))}else if(e<=4){m=e-2;for(y=0;y<8;y++)d=d*m+s[y],p=p*m+o[y];c=m*(i+m*(d/p))}else if(e<=12){g=e-4,p=-1;for(y=0;y<8;y++)d=d*g+a[y],p=p*g+f[y];c=u+g*(d/p)}else{var b=l[6],w=e*e;for(y=0;y<6;y++)b=b/w+l[y];b/=e;var E=Math.log(e),S=.9189385332046728;c=b+S-.5*E+e*(E-1)}return c}function normPdf(e,t,n){return Math.exp(-(n-e)*(n-e)/(2*t*t))/(Math.sqrt(2*Math.PI)*t)}function tCdf(e,t){var n;return e<1?n=Math.NaN:t===0?n=.5:e==1?n=.5+Math.atan(t)/Math.PI:t>0?n=1-incBeta(e/(e+t*t),e/2,.5)/2:t<0&&(n=incBeta(e/(e+t*t),e/2,.5)/2),n}function tInv(e,t){var n;return t<0||e<0?Math.NaN:e===0?Math.NEGATIVE_INFINITY:e==1?Math.POSITIVE_INFINITY:t==1?Math.tan(Math.PI*(e-.5)):e>=.5?(n=betaInv(2*(1-e),t/2,.5),Math.sqrt(t/n-t)):(n=betaInv(2*e,t/2,.5),-Math.sqrt(t/n-t))}function incBeta(e,t,n){var r;if(e<0||e>1)r=Math.NaN;else{r=0;var i=Math.exp(lnGamma(t+n)-lnGamma(t)-lnGamma(n)+t*Math.log(e)+n*Math.log(1-e));e<(t+1)/(t+n+2)?r=i*betaGuts(e,t,n)/t:r=1-i*betaGuts(1-e,n,t)/n}return r}function betaGuts(e,t,n){var r=t+1,i=t-1,s=t+n,o=1,u=o,a=o,f=1-s*e/r,l=0,c=l,h=l,p=l,d=l,v=l,m=1,g;while(a-v>4*eps*Math.abs(a))g=2*m,l=m*(n-m)*e/((i+g)*(t+g)),h=a+l*o,d=f+l*u,l=-(t+m)*(s+m)*e/((t+g)*(r+g)),c=h+l*a,p=d+l*f,v=a,o=h/p,u=d/p,a=c/p,m==1&&(f=1),m++;return a}function chi2Cdf(e,t){return gammaCdf(e,t/2,2)}function chi2Inv(e,t){var n=Math.NaN;if(e===0)n=0;else if(e==1)n=Math.POSITIVE_INFINITY;else if(e<0)n=Math.NaN;else{var r=1e-8,i=.001;n=Math.max(0,t+Math.sqrt(2*t)*normInv(e));var s=chi2Cdf(n,t),o=s,u=s,a=n,f=n;while(o>e)a=.8*a,o=chi2Cdf(a,t);while(u<e)f=1.2*f,u=chi2Cdf(f,t);n=(a+f)/2,s=chi2Cdf(n,t);while(Math.abs(s-e)>r||Math.abs(s-e)/e>i)s<e?a=n:f=n,n=(a+f)/2,s=chi2Cdf(n,t)}return n}function gammaCdf(e,t,n){var r=Math.NaN;return t<=0||n<=0||(e<=0?r=0:r=Math.min(incGamma(e/n,t),1)),r}function incGamma(e,t){var n=0,r=lnGamma(t+rmin);if(e===0)n=0;else if(t===0)n=1;else if(e<t+1){var i=t,s=1/i,o=s;while(Math.abs(o)>=10*eps*Math.abs(s))o*=e/++i,s+=o;n=s*Math.exp(-e+t*Math.log(e)-r)}else if(e>=t+1){var u=1,a=e,f=0,l=1,c=1,h=1,p=1,d=0,v,m;while(Math.abs(p-d)>=10*eps*Math.abs(p))d=p,v=h-t,u=(a+u*v)*c,f=(l+f*v)*c,m=h*c,a=e*u+m*a,l=e*f+m*l,c=1/a,p=l*c,h++;n=1-Math.exp(-e+t*Math.log(e)-r)*p}return n}function poissonPmf(e,t){var n=0;return t>=0&&(n=Math.exp(-e)*Math.pow(e,t)/factorial(t)),n}function poissonCdf(e,t){var n=0,r=0,i=0;while(i<=t)r+=Math.pow(e,i++)/factorial(t);return n+=Math.exp(-e)*r,n}function poissonTail(e,t){return 1-poissonCdf(e,t-1)}function factorial(e){var t=1;for(var n=e;n>1;n--)t*=n;return t}function binomialCoef(e,t){if(e<t||e<0)return 0;if(t===0||e===0||e==t)return 1;var n=Math.min(t,e-t),r=1;for(var i=0;i<n;i++)r*=(e-i)/(n-i);return r}function binomialPmf(e,t,n){var r=binomialCoef(e,n)*Math.pow(t,n)*Math.pow(1-t,e-n);return r}function binomialCdf(e,t,n){if(n<0)return 0;if(n>=e)return 1;var r=0;for(var i=0;i<=n;i++)r+=binomialPmf(e,t,i);return r}function binomialTail(e,t,n){if(n<0)return 1;if(n>=e)return 0;var r=0;for(var i=n;i<=e;i++)r+=binomialPmf(e,t,i);return r}function binomialInv(e,t,n){var r=0;if(n<0||n>1)r=NaN;else if(n===0)r=0;else if(n==1)r=e;else{r=0;var i=0;while(i<n)i+=binomialPmf(e,t,r++);r-=1}return r}function multinomialCoef(e,t){var n=0,r=vMinMax(e);if(typeof t=="undefined"||t===null)t=vSum(e);if(r[0]<0)alert("Error #1 in irGrade.multinomialCoef: a number of outcomes is negative!");else if(t==vSum(e)){n=factorial(t);for(var i=0;i<e.length;i++)n/=factorial(e[i])}return n}function multinomialPmf(e,t,n){var r=0,i=vMinMax(t),s=vMinMax(e);if(typeof n=="undefined"||n===null)n=vSum(e);if(e.length!=t.length)alert("Error #1 in irGrade.multinomialPmf: length of outcome and probability vectors do not match!");else if(i[0]<0)alert("Error #2 in irGrade.multinomialPmf: a probability is negative!");else if(s[0]<0)alert("Error #3 in irGrade.multinomialPmf: a number of outcomes is negative!");else if(n==vSum(e)){var o=vMult(1/vSum(t),t);r=factorial(n);for(var u=0;u<e.length;u++)r*=Math.pow(o[u],e[u])/factorial(e[u])}return r}function geoPmf(e,t){return t<1||e===0?0:Math.pow(1-e,t-1)*e}function geoCdf(e,t){return t<1||e===0?0:1-Math.pow(1-e,t)}function geoTail(e,t){return 1-geoCdf(e,t-1)}function geoInv(e,t){var n=0;if(t<0||t>1)n=Math.NaN;else if(t===0)n=0;else if(t==1)n=Math.POSITIVE_INFINITY;else{n=0;var r=0;while(r<t)r+=geoPmf(e,n++)}return n}function hyperGeoPmf(e,t,n,r){var i;return n<r||e<t||t<r||r<0||e<0?0:(i=binomialCoef(t,r)*binomialCoef(e-t,n-r)/binomialCoef(e,n),i)}function hyperGeoCdf(e,t,n,r){var i=0,s=Math.min(r,t);s=Math.min(s,n);for(var o=0;o<=s;o++)i+=hyperGeoPmf(e,t,n,o);return i}function hyperGeoTail(e,t,n,r){var i=0;for(var s=r;s<=Math.min(t,n);s++)i+=hyperGeoPmf(e,t,n,s);return i}function negBinomialPmf(e,t,n){if(t>n||t<0)return 0;var r=e*binomialPmf(n-1,e,t-1);return r}function negBinomialCdf(e,t,n){var r=0;for(var i=t;i<=n;i++)r+=negBinomialPmf(e,t,i);return r}function pDieRolls(e,t){if(e>4)return alert("Error #1 in irGrade.pDiceRolls: too many rolls "+e+". "),Math.NaN;var n=0;if(t<e||t>6*e)return 0;var r=Math.pow(6,e),i=0,s=0,o=0;if(e==1)return 1/r;if(e==2)for(i=1;i<=6;i++)for(s=1;s<=6;s++)i+s==t&&n++;else if(e==3)for(i=1;i<=6;i++)for(s=1;s<=6;s++)for(o=1;o<=6;o++)i+s+o==t&&n++;else if(e==4)for(i=1;i<=6;i++)for(s=1;s<=6;s++)for(o=1;o<=6;o++)for(var u=1;u<=6;u++)i+s+o+u==t&&n++;return n/r}function permutations(e,t){if(e<t||e<0)return 0;if(t===0||e===0)return 1;var n=1;for(var r=0;r<t;r++)n*=e-r;return n}function sgn(e){if(e>=0)return 1;if(e<0)return-1}function linspace(e,t,n){var r=new Array(n),i=(t-e)/(n-1);for(var s=0;s<n;s++)r[s]=e+s*i;return r}function rms(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n]*e[n];return t/=e.length,Math.sqrt(t)}function vMinMax(e){var t=e[0],n=e[0];for(var r=1;r<e.length;r++)t>e[r]&&(t=e[r]),n<e[r]&&(n=e[r]);var i=new Array(t,n);return i}function vMinMaxIndices(e){var t=e[0],n=0,r=e[0],i=0;for(var s=1;s<e.length;s++)t>e[s]&&(t=e[s],n=s),r<e[s]&&(r=e[s],i=s);var o=new Array(t,r,n,i);return o}function vMinMaxAbs(e){var t=Math.abs(e[0]),n=Math.abs(e[0]),r;for(var i=1;i<e.length;i++)r=Math.abs(e[i]),t>r&&(t=r),n<r&&(n=r);var s=new Array(t,n);return s}function randBoolean(e){if(typeof e=="undefined"||e===null)e=.5;return rand.next()<=e?!1:!0}function sortUnique(e,t){var n=e;typeof t!="undefined"&&t!==null?n.sort(t):n.sort();var r=[];r[0]=n[0];var i=0;for(var s=1;s<n.length;s++)n[s]!=r[i]&&(r[++i]=n[s]);return r}function uniqueCount(e){var t={};t[e[0]]=e[0];var n=0;for(n=1;n<e.length;n++)typeof t[e[n]]=="undefined"||t[e[n]]===null?t[e[n]]=1:t[e[n]]++;uc=new Array(2),uc[0]=[],uc[1]=[];var r=0;for(n in t)uc[0][r]=n,uc[1][r++]=t[n];return uc}function unique(e){return uniqueCount(e)[0]}function randPermutation(e,t){var n=listOfDistinctRandInts(e.length,0,e.length-1),r=new Array(e.length),i=0;for(i=0;i<e.length;i++)r[i]=e[n[i]];var s=0;if(typeof t!="undefined"&&t=="forward")s=new Array(2),s[0]=r,s[1]=n,r=s;else if(typeof t!="undefined"&&t=="inverse"){s=new Array(2),s[0]=r,s[1]=new Array(e.length);for(i=0;i<e.length;i++)s[1][n[i]]=i;r=s}return r}function cyclicPermutation(e,t){if(typeof t=="undefined"||t===null)t=1;var n=new Array(e);for(var r=0;r<e;r++)n[r]=(r+t)%e;return n}function distinctPermutation(e,t){if(typeof t=="undefined"||t===null)t=Math.min(3,e-1);return cyclicPermutation(e,t)}function distinctRandPermutation(e){function t(e){v=!1;for(var t=0;t<e.length;t++)e[t]==t&&(v=!0);return v}var n=new Array(e);for(var r=0;r<e;r++)n[r]=r;n=randPermutation(n);while(t(n))n=randPermutation(n);return n}function fakeBivariateData(e,t,n,r,i,s){var o=new Array(2);o[0]=new Array(e),o[1]=new Array(e),r===0&&(r=2);var u,a,f,l;if(t[0]!="polynomial")return alert("Error #1 in irGrade.fakeBivariateData()!\nUnsupported function type: "+t[0].toString()),null;if(typeof i=="undefined"||i===null)i=-10;if(typeof s=="undefined"||s===null)s=10;var c=(s-i)/(e-1);for(l=0;l<e;l++){u=i+l*c,o[0][l]=u,a=0,f=1;for(var h=1;h<t.length;h++)a+=f*t[h],f*=u;o[1][l]=a}var p=twoNorm(o[1]),d=new Array(e);for(l=0;l<e;l++)d[l]=rNorm();var v=Math.floor(e/3),m=Math.floor(2*e/3*rand.next());for(l=m;l<m+v;l++)d[l]=d[l]*n;var g=twoNorm(d);for(l=0;l<e;l++)o[1][l]+=d[l]*p/g/r;return o}function nextRand(){var e=this.seed/this.Q,t=this.seed%this.Q,n=this.A*t-this.R*e;return n>0?this.seed=n:this.seed=n+this.M,this.seed*this.oneOverM}function rng(e){if(typeof e=="undefined"||e===null){var t=new Date;this.seed=2345678901+t.getSeconds()*16777215+t.getMinutes()*65535}else this.seed=e;return this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.oneOverM=1/this.M,this.next=nextRand,this.getSeed=getRandSeed,this}function getRandSeed(){return this.seed}function crypt(e,t){var n=e.length,r=t.length,i=16,s=0,o,u=-1,a="";if(e.substr(0,2)=="0x")for(o=2;o<n;o+=2)++u>=r&&(u=0),s=parseInt(e.substr(o,2),i)^t.charCodeAt(u),a+=String.fromCharCode(s);else{a+="0x";for(o=0;o<n;o++)++u>=r&&(u=0),s=e.charCodeAt(o)^t.charCodeAt(u),a+=(s<i?"0":"")+s.toString(i)}return a}Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Number.prototype.fix=function(e){return parseFloat(this.toFixed(e))},function(){$.fn.popbox=function(e){var t=$.extend({selector:this.selector,open:".open",box:".box",arrow:".arrow",arrow_border:".arrow-border",close:".close"},e),n={open:function(e){e.preventDefault();var r=$(this),i=$(this).parent().find(t.box);i.find(t.arrow).css({left:i.width()/2-10}),i.find(t.arrow_border).css({left:i.width()/2-10}),i.css("display")=="block"?n.close():i.css({display:"block",top:10,left:r.parent().width()/2-i.width()/2}),typeof $(this).parent().data("onPopBox")!="undefined"&&$(this).parent().data("onPopBox")()},close:function(){$(t.box).fadeOut("fast")}};return $(document).bind("keyup",function(e){e.keyCode==27&&n.close()}),$(document).bind("click",function(e){$(e.target).closest(t.selector).length||n.close()}),this.each(function(){$(this).css("width")||$(this).css({width:$(t.box).width()}),$(t.open,this).bind("click",n.open),$(t.open,this).parent().find(t.close).bind("click",function(e){e.preventDefault(),n.close()})})}}.call(this);